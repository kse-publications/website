---
import '@/styles/globals.css'
import Layout from '../layouts/Layout.astro'
import SearchSection from '@/components/search-results/search-section'
import { getInitialPublications, searchPublications } from '../services/search/get-publications'
import type { FilterTypes } from '@/types/common/filter-types'
import type { PaginatedCollection } from '@/types/common/paginated-collection'
import type { PublicationSummary } from '@/types/publication-summary/publication-summary'
import { DEFAULT_PAGE } from '@/config/search-params'

let initialPublications: PaginatedCollection<PublicationSummary>
const searchParams = Astro.url.searchParams

const searchText = searchParams.get('searchText')
const filterType = searchParams.get('filterType') as FilterTypes

const isRecent = !searchText && !filterType

if (!searchText) {
  initialPublications = await getInitialPublications({ page: DEFAULT_PAGE, filterType })
} else {
  const searchData = {
    searchText: searchText || '',
    page: DEFAULT_PAGE,
    filterType: filterType,
  }
  initialPublications = await searchPublications(searchData)
}
---

<Layout title="KSE docs | Search">
  <SearchSection initialPublications={initialPublications} isRecent={isRecent} client:load />
</Layout>
